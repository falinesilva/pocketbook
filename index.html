<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Snapshot</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      @media print {
        button,
        input,
        select,
        form {
          display: none !important;
        }

        body {
          background: white !important;
          color: black !important;
        }

        section {
          break-inside: avoid;
        }
      }
    </style>
  </head>

  <body class="bg-slate-800 text-slate-100 h-screen overflow-hidden">
    <div class="h-full flex justify-center">
      <div class="w-full max-w-xl h-full bg-slate-900 flex flex-col">
        <!-- HEADER -->
        <div
          class="p-4 flex justify-between items-center border-b border-slate-700"
        >
          <div id="titleContainer" class="flex items-center gap-2"></div>

          <button
            onclick="window.print()"
            class="text-sm border px-3 py-1 text-slate-300"
          >
            Export PDF
          </button>
        </div>

        <!-- SCROLLABLE CONTENT -->
        <div class="flex-1 overflow-y-auto p-4 space-y-6">
          <!-- CASH -->
          <section>
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-sm font-medium">Cash</h3>
              <button data-toggle="cash" class="text-slate-400">−</button>
            </div>
            <div id="cashSection">
              <form id="cashForm" class="flex gap-2 mb-2">
                <input
                  id="cashName"
                  placeholder="Source"
                  class="w-full p-1 text-black"
                  required
                />
                <input
                  id="cashValue"
                  type="number"
                  placeholder="Amount"
                  class="w-24 p-1 text-black"
                  required
                />
                <button class="border px-2">Add</button>
              </form>
              <ul id="cashList" class="text-sm space-y-1"></ul>
              <p class="text-sm">Total: <span id="cashTotal">0</span></p>
            </div>
          </section>

          <!-- EXPENSES -->
          <section>
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-sm font-medium">Expenses</h3>
              <button data-toggle="expenses" class="text-slate-400">−</button>
            </div>
            <div id="expensesSection">
              <form id="expensesForm" class="flex gap-2 mb-2">
                <input
                  id="expensesName"
                  placeholder="Item"
                  class="w-full p-1 text-black"
                  required
                />
                <input
                  id="expensesValue"
                  type="number"
                  placeholder="Amount"
                  class="w-24 p-1 text-black"
                  required
                />
                <button class="border px-2">Add</button>
              </form>
              <ul id="expensesList" class="text-sm space-y-1"></ul>
              <p class="text-sm">Total: <span id="expensesTotal">0</span></p>
            </div>
          </section>

          <!-- EQUITY -->
          <section>
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-sm font-medium">Equity</h3>
              <button data-toggle="equity" class="text-slate-400">−</button>
            </div>
            <div id="equitySection">
              <form id="equityForm" class="flex gap-2 mb-2">
                <input
                  id="equityName"
                  placeholder="Asset"
                  class="w-full p-1 text-black"
                  required
                />
                <input
                  id="equityValue"
                  type="number"
                  placeholder="Value"
                  class="w-24 p-1 text-black"
                  required
                />
                <button class="border px-2">Add</button>
              </form>
              <ul id="equityList" class="text-sm space-y-1"></ul>
              <p class="text-sm">Total: <span id="equityTotal">0</span></p>
            </div>
          </section>

          <!-- DEBT -->
          <section>
            <div class="flex justify-between items-center mb-2">
              <h3 class="text-sm font-medium">Debt</h3>
              <button data-toggle="debt" class="text-slate-400">−</button>
            </div>
            <div id="debtSection">
              <form id="debtForm" class="flex gap-2 mb-2">
                <input
                  id="debtName"
                  placeholder="Liability"
                  class="w-full p-1 text-black"
                  required
                />
                <input
                  id="debtValue"
                  type="number"
                  placeholder="Amount"
                  class="w-24 p-1 text-black"
                  required
                />
                <button class="border px-2">Add</button>
              </form>
              <ul id="debtList" class="text-sm space-y-1"></ul>
              <p class="text-sm">Total: <span id="debtTotal">0</span></p>
            </div>
          </section>
        </div>

        <!-- RESULTS -->
        <div class="border-t border-slate-700 p-4 bg-slate-900 sticky bottom-0">
          <p>
            Cash − Expenses:
            <span id="result"></span>
          </p>
          <p>
            Net Worth (Equity − Debt):
            <span id="netWorth"></span>
          </p>
        </div>
      </div>
    </div>

    <!-- JS -->
    <script>
      /* ---------- TITLE + CURRENCY ---------- */

      const titleContainer = document.getElementById("titleContainer");

      let savedTitle = localStorage.getItem("snapshotTitle");
      let currency = localStorage.getItem("currency") || "USD";

      function formatMoney(value) {
        return new Intl.NumberFormat(currency === "USD" ? "en-US" : "pt-BR", {
          style: "currency",
          currency,
          minimumFractionDigits: 2,
        }).format(value);
      }

      function renderTitle() {
        titleContainer.innerHTML = "";

        const currencySelect = document.createElement("select");
        currencySelect.className = "text-black p-1 text-sm";
        currencySelect.innerHTML = `
          <option value="USD">USD ($)</option>
          <option value="BRL">BRL (R$)</option>
        `;
        currencySelect.value = currency;
        currencySelect.onchange = () => {
          currency = currencySelect.value;
          localStorage.setItem("currency", currency);
          updateUI();
        };

        if (savedTitle) {
          const h1 = document.createElement("h1");
          h1.textContent = savedTitle;
          h1.className = "text-lg font-medium";

          const edit = document.createElement("button");
          edit.textContent = "Edit";
          edit.className = "text-sm text-slate-400";
          edit.onclick = () => {
            savedTitle = null;
            localStorage.removeItem("snapshotTitle");
            renderTitle();
          };

          titleContainer.append(h1, edit, currencySelect);
        } else {
          const input = document.createElement("input");
          input.placeholder = "December 2025";
          input.className = "p-1 text-black";

          const save = document.createElement("button");
          save.textContent = "Save";
          save.className = "border px-2 text-sm";
          save.onclick = () => {
            if (!input.value.trim()) return;
            savedTitle = input.value.trim();
            localStorage.setItem("snapshotTitle", savedTitle);
            renderTitle();
          };

          titleContainer.append(input, save, currencySelect);
        }
      }

      renderTitle();

      /* ---------- FINANCIAL LOGIC ---------- */

      const categories = ["cash", "expenses", "equity", "debt"];

      const data = JSON.parse(localStorage.getItem("snapshotData")) || {
        cash: [],
        expenses: [],
        equity: [],
        debt: [],
      };

      function save() {
        localStorage.setItem("snapshotData", JSON.stringify(data));
      }

      function sum(cat) {
        return data[cat].reduce((s, i) => s + Number(i.value), 0);
      }

      function updateUI() {
        categories.forEach((cat) => {
          const list = document.getElementById(cat + "List");
          list.innerHTML = "";

          data[cat].forEach((item, index) => {
            const li = document.createElement("li");
            li.textContent = `${item.name}: ${formatMoney(item.value)}`;

            const remove = document.createElement("button");
            remove.textContent = "×";
            remove.className = "float-right text-slate-400";
            remove.onclick = () => {
              data[cat].splice(index, 1);
              save();
              updateUI();
            };

            li.appendChild(remove);
            list.appendChild(li);
          });

          document.getElementById(cat + "Total").textContent = formatMoney(
            sum(cat)
          );
        });

        document.getElementById("result").textContent = formatMoney(
          sum("cash") - sum("expenses")
        );

        document.getElementById("netWorth").textContent = formatMoney(
          sum("equity") - sum("debt")
        );
      }

      categories.forEach((cat) => {
        document.getElementById(cat + "Form").onsubmit = (e) => {
          e.preventDefault();
          const name = document.getElementById(cat + "Name").value.trim();
          const value = Number(document.getElementById(cat + "Value").value);
          if (!name || isNaN(value)) return;
          data[cat].push({ name, value });
          e.target.reset();
          save();
          updateUI();
        };
      });

      document.querySelectorAll("[data-toggle]").forEach((btn) => {
        btn.onclick = () => {
          const section = document.getElementById(
            btn.dataset.toggle + "Section"
          );
          section.classList.toggle("hidden");
          btn.textContent = section.classList.contains("hidden") ? "+" : "−";
        };
      });

      updateUI();
    </script>
  </body>
</html>
