<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Tracker</title>

    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="p-4 cursor-default bg-slate-800 text-white flex justify-center">
    <div class="w-full max-w-xl p-4 m-6 bg-slate-900 rounded-xl">
      <div class="flex h-8 mb-4 items-center justify-between">
        <!-- TODO: Add link to github -->
        <p class="text-sm cursor-default">PB-alpha-v1</p>
        <p class="text-xl font-semibold italic">December 2025</p>

        <button id="exportBtn" class="w-24 bg-transparent cursor-pointer">
          <img src="/assets/zap.png" alt="" aria-hidden="true" />
        </button>
      </div>
      <hr class="border-t border-gray-300 my-4" />

      <p>TOTAL (Cash - Bills - Expenses) = <span id="finalTotal">0</span></p>
      <p>SUBTOTAL (After Debts): <span id="subtotal">0</span></p>

      <hr class="border-t border-gray-300 my-4" />

      <div id="columns" class="flex flex-col gap-6">
        <div>
          <h3 class="font-semibold mb-2">Cash</h3>
          <form id="cashForm" class="flex gap-2 mb-2">
            <input
              type="text"
              id="cashName"
              placeholder="Name"
              required
              class="border p-1 w-32 text-black"
            />
            <input
              type="number"
              id="cashValue"
              placeholder="Amount"
              required
              class="border p-1 w-24 text-black"
            />
            <button type="submit" class="px-2 py-1 border">Add</button>
          </form>
          <ul id="cashList" class="space-y-1"></ul>
          <p>Total Cash: <span id="cashTotal">0</span></p>
        </div>

        <div>
          <h3 class="font-semibold mb-2">Bills</h3>
          <form id="billsForm" class="flex gap-2 mb-2">
            <input
              type="text"
              id="billsName"
              placeholder="Name"
              required
              class="border p-1 w-32 text-black"
            />
            <input
              type="number"
              id="billsValue"
              placeholder="Amount"
              required
              class="border p-1 w-24 text-black"
            />
            <button type="submit" class="px-2 py-1 border">Add</button>
          </form>
          <ul id="billsList" class="space-y-1"></ul>
          <p>Total Bills: <span id="billsTotal">0</span></p>
        </div>

        <div>
          <h3 class="font-semibold mb-2">Expenses</h3>
          <form id="expensesForm" class="flex gap-2 mb-2">
            <input
              type="text"
              id="expensesName"
              placeholder="Name"
              required
              class="border p-1 w-32 text-black"
            />
            <input
              type="number"
              id="expensesValue"
              placeholder="Amount"
              required
              class="border p-1 w-24 text-black"
            />
            <button type="submit" class="px-2 py-1 border">Add</button>
          </form>
          <ul id="expensesList" class="space-y-1"></ul>
          <p>Total Expenses: <span id="expensesTotal">0</span></p>
        </div>

        <div>
          <h3 class="font-semibold mb-2">Debts</h3>
          <form id="debtsForm" class="flex gap-2 mb-2">
            <input
              type="text"
              id="debtsName"
              placeholder="Name"
              required
              class="border p-1 w-32 text-black"
            />
            <input
              type="number"
              id="debtsValue"
              placeholder="Amount"
              required
              class="border p-1 w-24 text-black"
            />
            <button type="submit" class="px-2 py-1 border">Add</button>
          </form>
          <ul id="debtsList" class="space-y-1"></ul>
          <p>Total Debts: <span id="debtsTotal">0</span></p>
        </div>
      </div>

      <script>
        const categories = ["cash", "bills", "expenses", "debts"];
        const data = JSON.parse(localStorage.getItem("monthlyData")) || {
          cash: [],
          bills: [],
          expenses: [],
          debts: [],
        };

        function updateUI() {
          categories.forEach((cat) => {
            const list = document.getElementById(`${cat}List`);
            list.innerHTML = "";

            data[cat].forEach((item, index) => {
              const li = document.createElement("li");
              li.textContent = `${item.name}: ${item.value}`;

              if (item.paid) {
                li.classList.add("italic", "line-through", "opacity-70");
              }
              // TODO: Remove 'Paid' btn from Cash section
              const editBtn = document.createElement("button");
              editBtn.textContent = "Edit";
              editBtn.className = "border px-1";

              editBtn.onclick = () => {
                document.getElementById(`${cat}Name`).value = item.name;
                document.getElementById(`${cat}Value`).value = item.value;
                data[cat].splice(index, 1);
                saveData();
                updateUI();
              };

              const removeBtn = document.createElement("button");
              removeBtn.textContent = "Remove";
              removeBtn.className = "border px-1";

              removeBtn.onclick = () => {
                data[cat].splice(index, 1);
                saveData();
                updateUI();
              };

              const paidBtn = document.createElement("button");
              paidBtn.textContent = item.paid ? "Unpaid" : "Paid";
              paidBtn.className = "border px-1";

              paidBtn.onclick = () => {
                item.paid = !item.paid;
                saveData();
                updateUI();
              };

              const btnBox = document.createElement("span");
              btnBox.className = "float-right space-x-2";
              btnBox.append(editBtn, removeBtn, paidBtn);

              li.append(btnBox);
              list.appendChild(li);
            });

            const total = data[cat]
              .filter((i) => !i.paid)
              .reduce((s, i) => s + Number(i.value), 0);

            document.getElementById(`${cat}Total`).textContent =
              total.toFixed(2);
          });

          const cash = sum("cash");
          const bills = sum("bills");
          const expenses = sum("expenses");
          const debts = sum("debts");

          const final = cash - (bills + expenses);
          const subtotal = final - debts;

          document.getElementById("finalTotal").textContent = final.toFixed(2);
          document.getElementById("subtotal").textContent = subtotal.toFixed(2);
        }

        function sum(cat) {
          return data[cat]
            .filter((i) => !i.paid)
            .reduce((s, i) => s + Number(i.value), 0);
        }

        function saveData() {
          localStorage.setItem("monthlyData", JSON.stringify(data));
        }

        categories.forEach((cat) => {
          document
            .getElementById(`${cat}Form`)
            .addEventListener("submit", (e) => {
              e.preventDefault();
              const name = document.getElementById(`${cat}Name`).value.trim();
              const value = Number(
                document.getElementById(`${cat}Value`).value
              );
              if (name && !isNaN(value)) {
                data[cat].push({ name, value });
                document.getElementById(`${cat}Form`).reset();
                saveData();
                updateUI();
              }
            });
        });

        document.getElementById("exportBtn").onclick = () => {
          let text = "";

          const d = new Date().toDateString();

          text += `Pocketbook Report for ${d}\n\n`;

          categories.forEach((cat) => {
            text += `${cat.toUpperCase()}:\n`;
            data[cat].forEach((i) => (text += `${i.name}: ${i.value}\n`));
            text += `Total ${cat}: ${sum(cat)}\n\n`;
          });

          const final = sum("cash") - (sum("bills") + sum("expenses"));
          const subtotal = final - sum("debts");

          text += `Final Total: ${final}\nSubtotal (After Debts): ${subtotal}`;

          const url = "https://wa.me/?text=" + encodeURIComponent(text);
          window.open(url, "_blank");
        };

        updateUI();
      </script>
    </div>
  </body>
</html>
